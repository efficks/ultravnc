<html>
  <head><title>MS-Logon II for UltraVNC</title>
    <link rel="stylesheet" type="text/css" href="format.css">
  </head>
  <body>

    <h1 align="center">MS-Logon II for UltraVNC</h1>

    <h2>Description</h2>
    <p>With Ultra@VNC the WinVNC Server access can be managed using MS Users, Domains and Groups available from the machine 
      that is hosting this WinVNC server. NT domains and active directories are supported.</p>

    <p>In addition to the first implementation of MS-Logon (MS-Logon I), MS-Logon II is able to do cross-domain authentication,
      i.e. the user account can be in another domain than the computer account.</p>

    <p>MS-Logon II should work with Windows NT, Windows 2000, Windows XP and Windows 2003.<br>
      For W2K SP4 and W2K3 only as ultravnc service because of new restrictions
      (SeImpersonatePrivilege, see Knowlegdebase article 821546).</p>
    <p>Should recognize any nesting of groups.</p>
    <p>Should support domain\user and user@domain.com (UPN) naming.</p>

    <h2>Requirements</h2>

    <ul>
      <li>On Windows NT 4, you need at least <a href="http://www.microsoft.com/ntserver/nts/downloads/recommended/SP6/allSP6.asp">SP4</a> 
        and the <a href="http://www.microsoft.com/NTServer/nts/downloads/recommended/scm/default.asp">security configuration manager</a> installed.
      </li>
      <li>Under Windows XP, the <code>ForceGuest</code> registry value is set to <code>1</code> by default in the following registry key:
        <br><code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code>
        <br>If the Guest account is enabled, an SSPI logon will succeed as Guest for any user credentials. 
        <br>If <code>ForceGuest</code> is disabled (set to <code>0</code>), SSPI will log on as the specified user.
        <br>So it's important to disable <code>ForceGuest</code>. Otherwise all authorization is done against the guest account!
      </li>
      <li>Policy Settings: Authentication will fail if "Deny logon to the computer from the network" is enabled for a group the logon account is a member of.
         This applies to both Local Policy Settings as well as Group Policy Objects.
         <br>So make sure user accounts used for MSLogon authentication are not affected by these settings.
      </li>
    </ul>

    <h2>Configuration</h2>

    <h3>Manual configuration</h3>
    <p>Right click the WinVNC icon in the System Tray and choose "Admin Properties".</p>
    <p class="indent"><img src="traymenu.png" height="204" width="141"></p>
    <p>In the Admin Properties page check "Require MS-Logon" and "New MS-Logon".</p>
    <p class="indent"><img src="prop.png" height="110" width="261"></p>
    <p>Then click on "Configure MS Logon Groups".
      <br>Here you can add or remove users and groups or change their rights.</p>
    <p class="indent"><img src="mslogon.png" height="443" width="367"></p>
    <p><code>Interact</code> is the normal mode where you can take over mouse and keyboard. It's a synonym for <code>Full Control</code>.</p>
    <p><code>ViewOnly</code> allows the account to view the remote screen, but local mouse and keyboard cannot control the remote screen.</p>

    <h3>Automated configuration</h3>
    <p>You can use the <a href="MSLogonACL.html">MSLogonACL</a> tool to export the ACL from one machine and import it to another.</p>

    <h2>To be tested</h2>

    <p>Since MSLogon II is relatively new and there are various different scenarios how to use it, we encourage everybody to share their experience.
       Please post your results to the <a href="http://forum.ultravnc.net/viewforum.php?f=11">UltraVNC MS-Logon forum</a>.
       <br>There are a number of factors which are to be considered: Different OS versions, if Active Directory is used or old-style NT trusts, 
       whether local or domain based accounts are used, the naming convention which is used and various possible nesting of groups.
    </p>
    <dl>
      <dt>OS</dt>	<dd>WinNT, W2K, wXP, W2K3</dd>
      <dt>Infrastructure</dt>	<dd>With/without Active Directory</dd>
      <dt>Accounts</dt>	<dd>Local and/or domain users/groups</dd>
      <dt>Naming styles</dt>	<dd>user, machine\user, domain\user, user@domain.com (UPN), group, domain\group</dd>
      <dt>Domains</dt>	<dd>(implies trusts/AD) user and/or group in other domains than computer, 
	nested groups over multiple domains</dd>
    </dl>

    <h2>Known bugs (not fixed yet)</h2>

    <ul type="circle">
      <li>Error reporting / debugging to be improved</li>
    </ul>

    <h2>History</h2>

    <dl>
      <dt>10. 12. 2004</dt>
      <dd>Fix: Certain passwords (e.g. Abc0DefG) lead to authentication failure 
        (see <a href="http://forum.ultravnc.net/viewtopic.php?t=803">http://forum.ultravnc.net/viewtopic.php?t=803</a>)</dd>
      <dt>08. 12. 2004</dt>
      <dd>Fix: Changed authSSP.dll to Unicode to allow for extended chars (&auml;, &ouml;, &uuml;, &ccedil;, &szlig; etc.) in passwords.
        (see <a href="http://forum.ultravnc.net/viewtopic.php?t=1259">http://forum.ultravnc.net/viewtopic.php?t=1259</a>)</dd>
      <dt>29. 10. 2004</dt>
      <dd>Fix: Usernames with spaces fail to load with MSLogonACL tool 
        (see <a href="http://forum.ultravnc.net/viewtopic.php?t=1046&highlight=#4025">
        http://forum.ultravnc.net/viewtopic.php?t=1046&highlight=#4025</a>)</dd>
      <dt>07. 10. 2004</dt>	
      <dd>Changed list of groups to a real ACL.
        <br>Changed UI to SecurityPage.
        <br>Added import/export tool for ACL.<br></dd>
      <dt>20. 08. 2004</dt>
	<dd>Fix: Change in platform detection to call security.dll instead of secur32.dll on NT 4.</dd>
      <dt>04. 08. 2004</dt>
	<dd>Authorization now uses AccessCheck with SecurityDescriptor and Access Token.
          <br>Only one Windows logon attempt is required to test authentication and authorization.</dd>
      <dt>25. 06. 2004</dt>
	<dd>First try.</dd>
    </dl>

    <h2>Feedback</h2>

    <p>Please post feedback to the <a href="http://forum.ultravnc.net/viewforum.php?f=11">UltraVNC MS-Logon forum</a></p>
    <p class="footer">5. Jan. 2005, UltraVNC team</p>
  </body>
</html>